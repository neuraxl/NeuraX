<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraX-Ultime - L'Ère des Titans</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Face-api.js for Face Magic Vision -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        /* Custom CSS for cosmic theme */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at center, hsl(249, 47%, 32%) 0%, hsl(240, 71%, 8%) 100%);
            color: hsl(0, 0%, 98%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .cosmic-bg {
            background: radial-gradient(ellipse at center, hsl(249, 47%, 32%) 0%, hsl(240, 71%, 8%) 100%);
        }
        .cosmic-grid {
            background-image:
                radial-gradient(circle at 25% 25%, hsla(197, 100%, 50%, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, hsla(45, 100%, 50%, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, hsla(139, 84%, 54%, 0.05) 0%, transparent 50%);
        }
        .neural-connection {
            position: absolute;
            width: 1px;
            background: linear-gradient(45deg, var(--cosmic-cyan), var(--cosmic-green));
            animation: pulse 2s infinite;
            transition: all 0.5s ease-in-out;
            transform-origin: left center;
        }
        .cosmic-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--cosmic-cyan);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }
        /* Tailwind custom variables */
        :root {
            --cosmic-cyan: hsl(197, 100%, 50%);
            --cosmic-gold: hsl(45, 100%, 50%);
            --cosmic-green: hsl(139, 84%, 54%);
            --cosmic-purple: hsl(263, 70%, 50%);
        }

        /* Animations */
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-planet-orbit { animation: rotate 20s linear infinite; }
        @keyframes glow {
            0% { box-shadow: 0 0 20px hsla(248, 53%, 58%, 0.5); }
            100% { box-shadow: 0 0 40px hsla(248, 53%, 58%, 0.8); }
        }
        .animate-glow { animation: glow 2s ease-in-out infinite alternate; }

        /* Utility classes for active state */
        .section-hidden { display: none; }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: hsl(240, 54%, 15%); padding: 2rem;
            border-radius: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 600px; width: 90%; text-align: center; position: relative;
            transform: scale(0.9); opacity: 0; transition: all 0.3s ease;
        }
        .modal-overlay.show .modal-content { transform: scale(1); opacity: 1; }
        .modal-close-btn {
            position: absolute; top: 0.75rem; right: 0.75rem; background: none;
            border: none; color: #fff; font-size: 1.5rem; cursor: pointer;
        }
        
        /* Chatbot UI enhancements */
        .voice-btn-active { color: #ff6b6b !important; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 10px 20px rgba(255, 107, 107, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        /* Data Logging Section Styles */
        .pyramid-layer {
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .pyramid-layer:hover {
            background-color: hsla(197, 100%, 50%, 0.5) !important;
            transform: scale(1.05);
        }

        /* Titans Map Section Styles */
        .titans-map {
            background-image: url('https://placehold.co/1200x800/0a0a1a/1a1a3a?text=Cosmic+Map+Background');
            background-size: cover;
            background-position: center;
            border: 2px solid var(--cosmic-cyan);
            box-shadow: 0 0 30px var(--cosmic-cyan);
            transition: transform 0.5s ease-out;
        }
        .city-marker {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .city-marker .city-pulse {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            background-color: var(--cosmic-gold);
            animation: pulse-gold 2s infinite;
            opacity: 0.7;
        }
        .city-marker:hover { transform: scale(1.2); }
        @keyframes pulse-gold {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 10px 10px rgba(255, 215, 0, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
    </style>
</head>
<body class="cosmic-bg">
    <!-- Background elements -->
    <div class="fixed inset-0 cosmic-bg cosmic-grid pointer-events-none"></div>

    <div id="root" class="min-h-screen">
        <!-- Navigation Bar -->
        <nav class="relative z-50 bg-black/30 backdrop-blur-sm border-b border-white/10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <a href="#heroSection" class="flex items-center space-x-4 hover:opacity-80 transition-opacity nav-link" data-section-id="heroSection">
                        <div class="flex-shrink-0"><i class="fas fa-atom text-2xl text-cyan-400 animate-pulse-slow"></i></div>
                        <div>
                            <h1 class="text-xl font-bold text-white">NeuraX-Ultime</h1>
                            <p class="text-xs text-gray-300">L'Ère des Titans</p>
                        </div>
                    </a>
                    <div class="hidden md:flex items-center space-x-4">
                        <a href="#heroSection" class="nav-link transition-colors text-cyan-400" data-section-id="heroSection"><i class="fas fa-home mr-1"></i>Accueil</a>
                        <a href="#taskPlannerSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="taskPlannerSection"><i class="fas fa-tasks mr-1"></i>Planificateur</a>
                        <a href="#googleSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="googleSection"><i class="fab fa-google mr-1"></i>Google</a>
                        <a href="#openaiSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="openaiSection"><i class="fas fa-brain mr-1"></i>OpenAI</a>
                        <a href="#chatbotSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="chatbotSection"><i class="fas fa-comments mr-1"></i>Chatbot</a>
                        <a href="#architectureSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="architectureSection"><i class="fas fa-rocket mr-1"></i>Architecture</a>
                        <a href="#dataLoggingSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="dataLoggingSection"><i class="fas fa-database mr-1"></i>Logs</a>
                        <a href="#titansMapSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="titansMapSection"><i class="fas fa-map-marked-alt mr-1"></i>Carte</a>
                        <a href="#faceMagicSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="faceMagicSection"><i class="fas fa-link mr-1"></i>Connexion</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section id="heroSection" class="min-h-screen flex items-center justify-center relative section-active">
            <div class="text-center max-w-4xl mx-auto px-4 z-10">
                <h1 class="text-5xl md:text-7xl font-bold mb-6 bg-gradient-to-r from-cyan-400 via-purple-500 to-yellow-400 bg-clip-text text-transparent animate-pulse-slow">NeuraX-Ultime</h1>
                <p class="text-2xl md:text-3xl text-gray-300 mb-4">L'Ère des Titans</p>
                <p class="text-xl text-gray-200 max-w-3xl mx-auto leading-relaxed">Une intelligence cosmique forgée par les Titans, où les données forment des cités de pyramides à travers les galaxies.</p>
                <div class="flex flex-wrap gap-4 justify-center items-center mt-12">
                    <button class="bg-gradient-to-r from-cyan-400 to-purple-600 hover:from-cyan-300 hover:to-purple-500 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 animate-glow shadow-lg hover:shadow-cyan-400/25 nav-button" data-section-id="chatbotSection"><i class="fas fa-robot mr-2"></i>Contrôle Central</button>
                    <button class="border-2 border-yellow-400 text-yellow-400 hover:bg-yellow-400 hover:text-black px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-yellow-400/25 nav-button" data-section-id="taskPlannerSection"><i class="fas fa-tasks mr-2"></i>Planificateur IA</button>
                    <button class="border-2 border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-black px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-blue-400/25 nav-button" data-section-id="googleSection"><i class="fab fa-google mr-2"></i>Suite Google</button>
                    <button class="border-2 border-green-400 text-green-400 hover:bg-green-400 hover:text-black px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-green-400/25 nav-button" data-section-id="openaiSection"><i class="fas fa-brain mr-2"></i>Suite OpenAI</button>
                </div>
            </div>
        </section>

        <!-- NEW: Task Planner Section -->
        <section id="taskPlannerSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-white"><i class="fas fa-tasks text-yellow-400 mr-4"></i>Planificateur de Tâches Cosmiques</h2>
                    <p class="text-xl text-gray-300 max-w-3xl mx-auto">Donnez un objectif à NeuraX, et il générera un plan de mission complet.</p>
                </div>
                <div class="max-w-4xl mx-auto bg-black/30 rounded-2xl p-8 border border-white/10">
                    <div class="flex flex-col md:flex-row gap-4">
                        <input type="text" id="projectInput" class="flex-grow bg-black/30 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400" placeholder="Ex: Lancer une sonde vers Proxima Centauri...">
                        <button id="generatePlanBtn" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <span class="mr-2">✨</span> Générer le Plan de Mission
                        </button>
                    </div>
                    <div id="missionPlanContainer" class="mt-8">
                        <p class="text-center text-gray-400">Le plan de mission apparaîtra ici.</p>
                    </div>
                    <div id="missionBriefingContainer" class="mt-6 pt-6 border-t border-white/10"></div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Google Workspace Section -->
        <section id="googleSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-white"><i class="fab fa-google text-blue-400 mr-4"></i>Intégration Google Workspace</h2>
                    <p class="text-xl text-gray-300 max-w-3xl mx-auto">Contrôlez les applications Google via le chatbot N-X-U.</p>
                </div>
                <div class="bg-black/20 rounded-xl p-6 border border-white/10">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4" id="googleAppsContainer"></div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- OpenAI Suite Section -->
        <section id="openaiSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-white"><i class="fas fa-brain text-green-400 mr-4"></i>Intégration OpenAI Suite</h2>
                    <p class="text-xl text-gray-300 max-w-3xl mx-auto">Pilotez les outils OpenAI depuis le centre de contrôle.</p>
                </div>
                <div class="bg-black/20 rounded-xl p-6 border border-white/10">
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4" id="openaiAppsContainer"></div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Chatbot Section -->
        <section id="chatbotSection" class="min-h-screen py-20 relative section-hidden">
             <div class="max-w-4xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 bg-gradient-to-r from-cyan-400 via-purple-500 to-yellow-400 bg-clip-text text-transparent">Centre de Contrôle NeuraX</h2>
                    <p class="text-xl text-gray-300">Pilotez l'ensemble de l'écosystème par la parole ou le texte.</p>
                </div>
                <div class="bg-black/30 backdrop-blur-sm rounded-2xl border border-white/10 overflow-hidden">
                    <div class="bg-black/50 px-6 py-4 border-b border-white/10">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-cyan-400 to-purple-500 flex items-center justify-center animate-pulse-slow"><i class="fas fa-robot text-white"></i></div>
                                <div>
                                    <h3 class="font-semibold text-white">NeuraX-Ultime</h3>
                                    <p class="text-xs text-cyan-400">Intelligence Générale Orchestrée</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-96 overflow-y-auto p-6 space-y-4 bg-black/10" id="chatHistory">
                         <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-gradient-to-r from-cyan-400 to-purple-500"><i class="fas fa-robot text-xs text-white"></i></div>
                            <div class="rounded-2xl rounded-tl-sm p-4 max-w-2xl bg-black/30 border border-white/10">
                                <p class="text-white leading-relaxed whitespace-pre-wrap">Salutations. Je suis N-X-U. Donnez-moi un ordre, comme "Active Gmail et Drive", "Montre-moi l'architecture" ou "Dessine une nébuleuse en spirale".</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-white/10">
                        <div class="flex items-center space-x-4">
                            <input type="text" placeholder="Donnez un ordre ou posez une question..." class="flex-1 w-full bg-black/30 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 transition-colors duration-300" id="chatInput">
                            <button class="px-6 py-3 rounded-xl font-semibold transition-all duration-300 bg-gradient-to-r from-cyan-400 to-purple-500 hover:from-cyan-300 hover:to-purple-400 disabled:opacity-50" id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>
        
        <!-- Architecture Section -->
        <section id="architectureSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-white">Architecture Cosmologique</h2>
                    <p class="text-xl text-gray-300">Explorez les niveaux de l'intelligence distribuée.</p>
                </div>
                <div class="space-y-6">
                    <div id="architectureVisualizer" class="relative h-96 bg-black/20 rounded-2xl border border-white/10 overflow-hidden flex justify-center items-center">
                        <div class="relative w-96 h-96">
                            <button class="w-32 h-32 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-gradient-to-r from-purple-600 to-blue-800 flex items-center justify-center animate-pulse-slow"><i class="fas fa-brain text-2xl text-white"></i></button>
                            <button class="arch-satellite absolute top-0 left-0 w-16 h-16 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center hover:scale-110 transition-transform duration-300" data-system="vision"><i class="fas fa-eye text-sm text-white"></i></button>
                            <button class="arch-satellite absolute top-0 right-0 w-16 h-16 rounded-full bg-gradient-to-r from-yellow-500 to-orange-600 flex items-center justify-center hover:scale-110 transition-transform duration-300" data-system="langage"><i class="fas fa-language text-sm text-white"></i></button>
                            <button class="arch-satellite absolute bottom-0 left-0 w-16 h-16 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 flex items-center justify-center hover:scale-110 transition-transform duration-300" data-system="calcul"><i class="fas fa-calculator text-sm text-white"></i></button>
                            <button class="arch-satellite absolute bottom-0 right-0 w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-pink-600 flex items-center justify-center hover:scale-110 transition-transform duration-300" data-system="memoire"><i class="fas fa-memory text-sm text-white"></i></button>
                            <div id="neuralConnectionsContainer"></div>
                        </div>
                    </div>
                </div>
                <div class="mt-8">
                    <div class="flex justify-center space-x-4">
                        <button class="architecture-button bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg border border-white/10" data-action="universe-view"><i class="fas fa-home mr-2"></i>Vue Univers</button>
                        <button class="architecture-button px-6 py-3 rounded-lg border border-white/10 bg-purple-600 text-white" data-action="auto-explore"><i class="fas fa-play mr-2"></i>Exploration</button>
                        <button class="architecture-button px-6 py-3 rounded-lg border border-white/10 bg-cyan-600 text-white" data-action="connections"><i class="fas fa-project-diagram mr-2"></i>Connexions</button>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Data Logging Section -->
        <section id="dataLoggingSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-green-400 via-cyan-500 to-yellow-400 bg-clip-text text-transparent">Archives des Titans</h2>
                    <p class="text-xl text-gray-300">Zoomez sur les pyramides pour inspecter les briques de logs.</p>
                </div>
                <div class="relative w-full max-w-md mx-auto h-96">
                    <div class="absolute w-full h-full" id="pyramidContainer">
                        <!-- Pyramid layers will be injected here -->
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Titans Map Section -->
        <section id="titansMapSection" class="min-h-screen py-20 relative section-hidden">
             <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-yellow-400 via-purple-500 to-pink-400 bg-clip-text text-transparent">Carte des Cités des Titans</h2>
                    <p class="text-xl text-gray-300">Cliquez sur une cité pour zoomer et en savoir plus.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="md:col-span-2 h-[600px] relative rounded-2xl overflow-hidden">
                        <div id="titansMap" class="w-full h-full titans-map">
                            <div class="city-marker" style="top: 25%; left: 30%;" data-city="aethelgard" data-zoom-pos="25% 30%"><i class="fas fa-place-of-worship text-3xl text-yellow-300"></i><div class="city-pulse"></div></div>
                            <div class="city-marker" style="top: 50%; left: 70%;" data-city="solara" data-zoom-pos="50% 70%"><i class="fas fa-place-of-worship text-3xl text-yellow-300"></i><div class="city-pulse"></div></div>
                            <div class="city-marker" style="top: 75%; left: 45%;" data-city="umbra" data-zoom-pos="75% 45%"><i class="fas fa-place-of-worship text-3xl text-yellow-300"></i><div class="city-pulse"></div></div>
                        </div>
                    </div>
                    <div id="cityInfoPanel" class="bg-black/30 backdrop-blur-sm rounded-2xl p-8 border border-white/10">
                        <h3 id="cityName" class="text-3xl font-bold text-yellow-400 mb-4">Sélectionnez une Cité</h3>
                        <p id="cityDescription" class="text-gray-300 mb-6">Cliquez sur un marqueur.</p>
                        <div id="cityLog" class="mt-4 pt-4 border-t border-white/50 text-sm text-gray-300 italic"></div>
                        <button id="cityReportBtn" class="mt-4 w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-all duration-300 hidden">✨ Demander un Rapport de Situation</button>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Face Magic Vision Section -->
        <section id="faceMagicSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative flex flex-col items-center">
                <div class="text-center mb-8">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-pink-400 via-purple-500 to-cyan-400 bg-clip-text text-transparent">Connexion NeuraX</h2>
                    <p class="text-xl text-gray-300">Connectez-vous à l'écosystème via l'analyse biométrique.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 w-full">
                    <div class="lg:col-span-3 relative w-full max-w-3xl mx-auto bg-black/30 rounded-2xl border border-white/10 p-4">
                        <video id="faceMagicVideo" class="w-full h-auto rounded-lg" autoplay muted playsinline></video>
                        <canvas id="faceMagicCanvas" class="absolute top-4 left-4 w-[calc(100%-2rem)] h-[calc(100%-2rem)] rounded-lg"></canvas>
                    </div>
                    <div id="biometricDataPanel" class="lg:col-span-2 bg-black/30 rounded-2xl p-6 border border-white/10">
                        <h3 class="text-2xl font-bold text-cyan-400 mb-6"><i class="fas fa-link mr-3"></i>Analyse de Connexion</h3>
                        <div id="biometricResults" class="space-y-4 text-lg"><p class="text-gray-400">En attente...</p></div>
                        <div id="faceMagicStatus" class="mt-6 text-center text-gray-300 bg-black/30 rounded-lg px-4 py-2 border border-white/10">Chargement...</div>
                        <button id="interpretBiometricsBtn" class="mt-4 w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>✨ Interpréter la connexion</button>
                        <div id="biometricInterpretation" class="mt-4 pt-4 border-t border-white/20 text-sm text-gray-300"></div>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg border border-white/10 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Floating Navigation Buttons -->
        <div class="fixed right-8 top-1/2 transform -translate-y-1/2 z-50 space-y-3">
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-cyan-400 text-black" title="Accueil" data-section-id="heroSection"><i class="fas fa-home text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Planificateur" data-section-id="taskPlannerSection"><i class="fas fa-tasks text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Google" data-section-id="googleSection"><i class="fab fa-google text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="OpenAI" data-section-id="openaiSection"><i class="fas fa-brain text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Chatbot" data-section-id="chatbotSection"><i class="fas fa-comments text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Architecture" data-section-id="architectureSection"><i class="fas fa-rocket text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Logs" data-section-id="dataLoggingSection"><i class="fas fa-database text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Carte" data-section-id="titansMapSection"><i class="fas fa-map-marked-alt text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Connexion" data-section-id="faceMagicSection"><i class="fas fa-link text-sm"></i></button>
        </div>
    </div>

    <!-- Generic Modal for Zoom Views -->
    <div id="zoomModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeZoomModal">&times;</button>
            <h3 class="text-2xl font-bold text-cyan-400 mb-4" id="zoomModalTitle"></h3>
            <div class="text-gray-300 text-left" id="zoomModalContent"></div>
            <div id="zoomModalActions" class="mt-4"></div>
        </div>
    </div>

    <script>
        // --- Custom Modal Logic ---
        const zoomModal = document.getElementById('zoomModal');
        const zoomModalTitle = document.getElementById('zoomModalTitle');
        const zoomModalContent = document.getElementById('zoomModalContent');
        const zoomModalActions = document.getElementById('zoomModalActions');
        document.getElementById('closeZoomModal').addEventListener('click', () => zoomModal.classList.remove('show'));
        zoomModal.addEventListener('click', (e) => e.target === zoomModal && zoomModal.classList.remove('show'));

        function showZoomModal(title, content, actionsHtml = '') {
            zoomModalTitle.innerHTML = title;
            zoomModalContent.innerHTML = content;
            zoomModalActions.innerHTML = actionsHtml;
            zoomModal.classList.add('show');
        }

        // --- Section Navigation Logic ---
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => section.classList.add('section-hidden'));
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.remove('section-hidden');

            document.querySelectorAll('.nav-link, .floating-nav-btn').forEach(el => {
                const isForActiveSection = el.dataset.sectionId === sectionId;
                el.classList.toggle('text-cyan-400', isForActiveSection);
                el.classList.toggle('text-gray-300', !isForActiveSection);
                if (el.classList.contains('floating-nav-btn')) {
                    el.classList.toggle('bg-cyan-400', isForActiveSection);
                    el.classList.toggle('text-black', isForActiveSection);
                    el.classList.toggle('bg-black/30', !isForActiveSection);
                }
            });
            
            if (sectionId === 'faceMagicSection') initFaceMagic(); else stopFaceMagic();
        }

        document.querySelectorAll('.nav-link, .nav-button, .floating-nav-btn').forEach(el => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.currentTarget.dataset.sectionId;
                if (sectionId) showSection(sectionId);
            });
        });

        // --- Chatbot & Command Center Logic ---
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');
        const chatHistory = document.getElementById('chatHistory');
        let chatHistoryArray = [];

        function addMessageToChat(message, isUser, options = {}) {
            const { isCommandResponse = false, module = null, imageUrl = null, isThinking = false } = options;
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('flex', 'items-start', 'space-x-3', 'my-4');
            const avatarDiv = document.createElement('div');
            avatarDiv.classList.add('w-8', 'h-8', 'rounded-full', 'flex', 'items-center', 'justify-center', 'flex-shrink-0');
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('rounded-2xl', 'p-4', 'max-w-2xl', 'border', 'border-white/10');
            
            if (isUser) {
                messageContainer.classList.add('justify-end');
                avatarDiv.classList.add('bg-blue-500');
                avatarDiv.innerHTML = '<i class="fas fa-user text-xs text-white"></i>';
                messageBubble.classList.add('bg-blue-600', 'rounded-br-sm');
                messageContainer.appendChild(messageBubble);
                messageContainer.appendChild(avatarDiv);
            } else {
                messageContainer.classList.add('justify-start');
                avatarDiv.classList.add('bg-gradient-to-r', 'from-cyan-400', 'to-purple-500');
                avatarDiv.innerHTML = `<i class="fas ${isCommandResponse ? 'fa-cogs' : 'fa-robot'} text-xs text-white"></i>`;
                messageBubble.classList.add('bg-black/30', 'rounded-tl-sm');
                if (isCommandResponse) messageBubble.classList.add('border-yellow-400/50');
                messageContainer.appendChild(avatarDiv);
                messageContainer.appendChild(messageBubble);
            }
            
            if (imageUrl) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = "Image générée par l'IA";
                img.classList.add('rounded-lg', 'mb-2', 'max-w-xs', 'h-auto');
                messageBubble.appendChild(img);
            }

            const messageText = document.createElement('p');
            messageText.classList.add('text-white', 'leading-relaxed', 'whitespace-pre-wrap');
            messageText.textContent = message;
            
            if(isThinking) {
                 messageText.innerHTML = '<span class="animate-pulse">...</span>';
            }

            messageBubble.appendChild(messageText);

            if (module) {
                const moduleText = document.createElement('p');
                moduleText.classList.add('text-xs', 'text-gray-400', 'mt-2', 'border-t', 'border-white/10', 'pt-2');
                moduleText.textContent = `Orchestré via : ${module}`;
                messageBubble.appendChild(moduleText);
            }
            
            chatHistory.appendChild(messageContainer);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            return messageContainer;
        }

        async function handleUserInput() {
            const prompt = chatInput.value.trim();
            if (!prompt) return;
            addMessageToChat(prompt, true);
            chatInput.value = '';
            chatInput.disabled = true;
            sendChatBtn.disabled = true;
            await orchestrateResponse(prompt);
            chatInput.disabled = false;
            sendChatBtn.disabled = false;
            chatInput.focus();
        }
        
        sendChatBtn.addEventListener('click', handleUserInput);
        chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && !sendChatBtn.disabled && handleUserInput());

        // --- N-X-U Orchestrator ---
        async function orchestrateResponse(prompt) {
            const p = prompt.toLowerCase();
            if (parseAndExecuteCommand(p)) return;

            if (p.includes('dessine') || p.includes('génère') || p.includes('crée une image')) {
                const thinkingMessage = addMessageToChat("Génération de l'image en cours...", false, { isThinking: true, module: "Imagen 3 via GPT-5" });
                const imageUrl = await callImagenAPI(prompt);
                thinkingMessage.remove();
                if(imageUrl) {
                    addMessageToChat(`Voici l'image que j'ai générée.`, false, { module: "GPT-5 (Création Multimédia)", imageUrl });
                } else {
                    addMessageToChat(`Désolé, je n'ai pas pu générer l'image.`, false, { module: "GPT-5 (Création Multimédia)" });
                }
                return;
            }

            if (p.includes('éthique') || p.includes('dilemme') || p.includes('penses-tu')) {
                const ethicalPrompt = `En tant que modèle d'IA axé sur l'éthique et la sécurité (simulant Claude 3.7), donnez une réponse nuancée et réfléchie à la question suivante : "${prompt}"`;
                await callGeminiAPI(ethicalPrompt, "Claude 3.7 Sonnet (Raisonnement Éthique)");
                return;
            }
            
            const generalPrompt = `En tant qu'intelligence générale orchestrée (fusion de GPT-5, Claude 3.7 et Gemini 2.5), fournissez une réponse synthétisée et complète à la requête suivante : "${prompt}"`;
            await callGeminiAPI(generalPrompt, "Gemini 2.5 Pro (Synthèse Générale)");
        }

        async function callGeminiAPI(prompt, moduleName) {
            const thinkingMessage = addMessageToChat("...", false, { isThinking: true });
            try {
                chatHistoryArray.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistoryArray };
                const apiKey = ""; // Provided by Canvas environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Je n'ai pas de réponse pour le moment.";
                chatHistoryArray.push({ role: "model", parts: [{ text: text }] });
                thinkingMessage.remove();
                addMessageToChat(text, false, { module: moduleName });
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                thinkingMessage.remove();
                addMessageToChat("Désolé, une erreur est survenue lors de la connexion à l'intelligence cosmique.", false);
            }
        }
        
        async function callImagenAPI(prompt) {
            try {
                const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                const result = await response.json();
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    return `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                }
                return null;
            } catch (error) {
                console.error("Error calling Imagen API:", error);
                return null;
            }
        }

        // --- Command Parsing and Execution ---
        const appNameToId = {
            'gmail': 'gmail', 'drive': 'google-drive', 'sheets': 'google-sheets', 'docs': 'google-docs',
            'calendar': 'google-calendar', 'slides': 'google-slides', 'forms': 'google-forms', 'meet': 'google-meet',
            'gpt chat': 'gpt-chat', 'dall-e': 'dall-e-3', 'dalle': 'dall-e-3', 'vision': 'gpt-vision',
            'whisper': 'whisper', 'tts': 'text-to-speech', 'assistants': 'assistants-ia'
        };

        function parseAndExecuteCommand(prompt) {
            const navCommands = { 'accueil': 'heroSection', 'planificateur': 'taskPlannerSection', 'tâches': 'taskPlannerSection', 'architecture': 'architectureSection', 'chatbot': 'chatbotSection', 'logs': 'dataLoggingSection', 'données': 'dataLoggingSection', 'carte': 'titansMapSection', 'connexion': 'faceMagicSection', 'biométrie': 'faceMagicSection', 'google': 'googleSection', 'openai': 'openaiSection' };
            for (const [key, sectionId] of Object.entries(navCommands)) {
                if (prompt.includes(`affiche ${key}`) || prompt.includes(`montre ${key}`)) {
                    showSection(sectionId);
                    addMessageToChat(`Affichage de la section : ${key.charAt(0).toUpperCase() + key.slice(1)}.`, false, { isCommandResponse: true, module: "N-X-U Core (Navigation)" });
                    return true;
                }
            }

            const archCommands = { 'connexions': 'connections', 'exploration': 'auto-explore', 'univers': 'universe-view' };
            for (const [key, action] of Object.entries(archCommands)) {
                if (prompt.includes('architecture') && prompt.includes(key)) {
                    showSection('architectureSection');
                    setTimeout(() => document.querySelector(`.architecture-button[data-action="${action}"]`)?.click(), 100);
                    addMessageToChat(`Action d'architecture exécutée : ${key}.`, false, { isCommandResponse: true, module: "N-X-U Core (Contrôle)" });
                    return true;
                }
            }

            const action = prompt.includes('active') ? true : (prompt.includes('désactive') ? false : null);
            if (action !== null) {
                let targets = [];
                if (prompt.includes('tout google') || prompt.includes('tous les outils google')) {
                    document.querySelectorAll('#googleAppsContainer .app-card').forEach(card => targets.push(card.id));
                } else if (prompt.includes('tout openai') || prompt.includes('tous les outils openai')) {
                    document.querySelectorAll('#openaiAppsContainer .app-card').forEach(card => targets.push(card.id));
                } else {
                    for (const [name, id] of Object.entries(appNameToId)) {
                        if (prompt.includes(name)) targets.push(id);
                    }
                }

                if (targets.length > 0) {
                    let count = 0;
                    targets.forEach(appId => {
                        if (controlApp(appId, action)) count++;
                    });
                    addMessageToChat(`${count} application(s) ${action ? 'activée(s)' : 'désactivée(s)'}.`, false, { isCommandResponse: true, module: "N-X-U Core (Contrôle d'App)" });
                    return true;
                }
            }
            return false;
        }

        // --- App Control Logic ---
        function controlApp(appId, shouldBeActive) {
            const appCard = document.getElementById(appId);
            if (!appCard) return false;
            const isActive = appCard.dataset.active === 'true';
            if (isActive !== shouldBeActive) {
                appCard.querySelector('.app-toggle-btn')?.click();
                return true;
            }
            return false;
        }

        // --- App Suites Data and Generation ---
        const googleApps = [
            { id: 'gmail', name: 'Gmail', icon: 'fa-envelope' }, { id: 'google-drive', name: 'Drive', icon: 'fa-google-drive', brand: true },
            { id: 'google-sheets', name: 'Sheets', icon: 'fa-table' }, { id: 'google-docs', name: 'Docs', icon: 'fa-file-word' },
            { id: 'google-calendar', name: 'Calendar', icon: 'fa-calendar' }, { id: 'google-slides', name: 'Slides', icon: 'fa-presentation' }
        ];
        const openaiApps = [
            { id: 'gpt-chat', name: 'GPT Chat', icon: 'fa-comments' }, { id: 'dall-e-3', name: 'DALL-E 3', icon: 'fa-palette' },
            { id: 'gpt-vision', name: 'GPT Vision', icon: 'fa-eye' }, { id: 'whisper', name: 'Whisper', icon: 'fa-microphone' },
            { id: 'text-to-speech', name: 'TTS', icon: 'fa-volume-up' }, { id: 'assistants-ia', name: 'Assistants', icon: 'fa-robot' }
        ];

        function createAppCard(app) {
            const card = document.createElement('div');
            card.id = app.id;
            card.className = 'app-card bg-black/20 rounded-xl p-4 border border-white/10 text-center transition-all duration-300';
            card.dataset.active = 'false';
            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <i class="fa${app.brand ? 'b' : 's'} ${app.icon} text-2xl text-gray-400"></i>
                    <button class="gemini-suggest-btn text-yellow-400 hover:text-yellow-300 text-xs">✨</button>
                </div>
                <h4 class="font-semibold text-white mt-2">${app.name}</h4>
                <p class="app-status text-xs text-gray-400 mb-3">Inactif</p>
                <button class="app-toggle-btn w-12 h-6 rounded-full bg-gray-600 transition-colors duration-300 relative">
                    <div class="toggle-circle w-4 h-4 bg-white rounded-full absolute top-1 left-1 transition-transform duration-300"></div>
                </button>
            `;
            card.querySelector('.app-toggle-btn').addEventListener('click', () => toggleApp(card));
            card.querySelector('.gemini-suggest-btn').addEventListener('click', async () => {
                const prompt = `Suggère un cas d'usage créatif et synergique pour combiner NeuraX-Ultime avec ${app.name}.`;
                showZoomModal(`✨ Cas d'usage pour ${app.name}`, '<p class="animate-pulse">Génération en cours...</p>');
                const suggestion = await callGeminiAPIForContent(prompt);
                showZoomModal(`✨ Cas d'usage pour ${app.name}`, `<p>${suggestion}</p>`);
            });
            return card;
        }

        async function callGeminiAPIForContent(prompt) {
            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) return "Erreur de génération.";
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Aucune suggestion pour le moment.";
            } catch (error) {
                return "Erreur de connexion à l'API.";
            }
        }

        function toggleApp(appCard) {
            let isActive = appCard.dataset.active === 'true';
            isActive = !isActive;
            appCard.dataset.active = isActive;
            const statusEl = appCard.querySelector('.app-status');
            const iconEl = appCard.querySelector('i');
            const toggleBtn = appCard.querySelector('.app-toggle-btn');
            const toggleCircle = appCard.querySelector('.toggle-circle');

            if (isActive) {
                appCard.classList.add('border-cyan-400/50', 'bg-cyan-400/5');
                statusEl.textContent = 'Actif';
                statusEl.classList.replace('text-gray-400', 'text-cyan-400');
                iconEl.classList.replace('text-gray-400', 'text-cyan-400');
                toggleBtn.classList.replace('bg-gray-600', 'bg-cyan-500');
                toggleCircle.style.transform = 'translateX(1.5rem)';
            } else {
                appCard.classList.remove('border-cyan-400/50', 'bg-cyan-400/5');
                statusEl.textContent = 'Inactif';
                statusEl.classList.replace('text-cyan-400', 'text-gray-400');
                iconEl.classList.replace('text-cyan-400', 'text-gray-400');
                toggleBtn.classList.replace('bg-cyan-500', 'bg-gray-600');
                toggleCircle.style.transform = 'translateX(0)';
            }
        }
        
        // --- Architecture Zoom Logic ---
        document.querySelectorAll('.arch-satellite').forEach(sat => {
            sat.addEventListener('click', async () => {
                const system = sat.dataset.system;
                const titles = { vision: 'Système de Vision', langage: 'Système de Langage', calcul: 'Système de Calcul', memoire: 'Système de Mémoire' };
                const prompt = `Génère une description courte et créative pour un système planétaire dans une IA cosmologique nommé "${titles[system]}".`;
                const actionsHtml = `<button id="analyzeSystemBtn" class="mt-4 bg-yellow-500 text-black font-bold py-2 px-4 rounded-lg">✨ Lancer une Analyse Approfondie</button>`;
                showZoomModal(`<i class="fas fa-satellite-dish mr-3"></i> ${titles[system]}`, '<p class="animate-pulse">Génération en cours...</p>', actionsHtml);
                const description = await callGeminiAPIForContent(prompt);
                showZoomModal(
                    `<i class="fas fa-satellite-dish mr-3"></i> ${titles[system]}`, 
                    `<p>${description}</p><div id="systemAnalysisResult" class="mt-4 pt-4 border-t border-white/20 text-sm italic"></div>`,
                    actionsHtml
                );
                document.getElementById('analyzeSystemBtn').addEventListener('click', async () => {
                    const analysisResultEl = document.getElementById('systemAnalysisResult');
                    analysisResultEl.innerHTML = '<p class="animate-pulse">Analyse en cours...</p>';
                    const analysisPrompt = `En tant que N-X-U, effectue une analyse approfondie du "${titles[system]}". Décris ses capacités, ses limites actuelles et une synergie possible avec un autre système.`;
                    const analysis = await callGeminiAPIForContent(analysisPrompt);
                    analysisResultEl.innerHTML = `<p>${analysis}</p>`;
                });
            });
        });

        // --- Data Logging Pyramid Logic ---
        const pyramidContainer = document.getElementById('pyramidContainer');
        const pyramidLayers = 5;
        for (let i = 0; i < pyramidLayers; i++) {
            const layer = document.createElement('div');
            const size = 100 - i * 20;
            layer.className = 'pyramid-layer absolute bottom-0 left-1/2 -translate-x-1/2';
            layer.style.width = `${size}%`;
            layer.style.height = `${100 - i * 18}%`;
            layer.style.backgroundColor = `hsla(220, 50%, ${20 + i * 10}%, 0.5)`;
            layer.style.zIndex = pyramidLayers - i;
            layer.dataset.layer = i + 1;
            layer.addEventListener('click', () => {
                const logs = Math.floor(Math.random() * 500000) + 100000;
                const actionsHtml = `<button id="analyzeLayerBtn" class="mt-4 bg-yellow-500 text-black font-bold py-2 px-4 rounded-lg">✨ Analyser cette couche</button>`;
                showZoomModal(
                    `<i class="fas fa-database mr-3"></i>Couche de Pyramide ${layer.dataset.layer}`, 
                    `<p>Cette couche contient <strong>${logs.toLocaleString('fr-FR')}</strong> briques de logs.</p><div id="layerAnalysisResult" class="mt-4 pt-4 border-t border-white/20 text-sm italic"></div>`,
                    actionsHtml
                );
                document.getElementById('analyzeLayerBtn').addEventListener('click', async () => {
                    const analysisResultEl = document.getElementById('layerAnalysisResult');
                    analysisResultEl.innerHTML = '<p class="animate-pulse">Analyse en cours...</p>';
                    const prompt = `En tant que N-X-U, analyse la couche de données ${layer.dataset.layer} contenant ${logs} logs et génère un bref rapport de renseignement fictif (2-3 phrases).`;
                    const analysis = await callGeminiAPIForContent(prompt);
                    analysisResultEl.innerHTML = `<p>${analysis}</p>`;
                });
            });
            pyramidContainer.appendChild(layer);
        }

        // --- Titans Map Zoom Logic ---
        const titansMap = document.getElementById('titansMap');
        const cityData = {
            aethelgard: { name: "Cité d'Aethelgard", description: "Le cœur technologique des Titans, où les premières pyramides de données ont été érigées." },
            solara: { name: "Nexus de Solara", description: "Une cité orbitale qui collecte l'énergie stellaire pour alimenter le réseau." },
            umbra: { name: "Forteresse d'Umbra", description: "Dédiée à l'archivage sécurisé des données les plus sensibles." }
        };
        document.querySelectorAll('.city-marker').forEach(marker => {
            marker.addEventListener('click', async () => {
                const cityId = marker.dataset.city;
                const data = cityData[cityId];
                const zoomPos = marker.dataset.zoomPos;
                titansMap.style.transform = 'scale(1.5)';
                titansMap.style.transformOrigin = zoomPos;
                document.getElementById('cityName').textContent = data.name;
                document.getElementById('cityDescription').textContent = data.description;
                const cityLogEl = document.getElementById('cityLog');
                const cityReportBtn = document.getElementById('cityReportBtn');
                cityLogEl.innerHTML = '<p class="animate-pulse">Récupération du dernier log...</p>';
                const logPrompt = `Écris une entrée de log courte et fictive (une phrase) provenant de la cité futuriste de "${data.name}".`;
                const log = await callGeminiAPIForContent(logPrompt);
                cityLogEl.innerHTML = `<p>"${log}"</p>`;
                cityReportBtn.classList.remove('hidden');
                cityReportBtn.onclick = async () => {
                    cityLogEl.innerHTML = '<p class="animate-pulse">Génération du rapport de situation...</p>';
                    const reportPrompt = `En tant que N-X-U, génère un rapport de situation détaillé (3-4 phrases) pour la cité de ${data.name}.`;
                    const report = await callGeminiAPIForContent(reportPrompt);
                    cityLogEl.innerHTML = `<p>${report}</p>`;
                };
                setTimeout(() => {
                    titansMap.style.transform = 'scale(1)';
                }, 3000);
            });
        });


        // --- Face Magic Vision Logic ---
        const fmVideo = document.getElementById("faceMagicVideo");
        const fmCanvas = document.getElementById("faceMagicCanvas");
        const fmCtx = fmCanvas.getContext("2d");
        const fmStatus = document.getElementById("faceMagicStatus");
        const biometricResultsEl = document.getElementById('biometricResults');
        const interpretBtn = document.getElementById('interpretBiometricsBtn');
        const interpretationResultEl = document.getElementById('biometricInterpretation');
        let fmIsInitialized = false;
        let fmAnimationRequest;
        let lastBiometricData = null;

        interpretBtn.addEventListener('click', async () => {
            if (!lastBiometricData) return;
            const { age, gender, expression } = lastBiometricData;
            interpretationResultEl.innerHTML = '<p class="animate-pulse">Interprétation en cours...</p>';
            const prompt = `En tant que N-X-U, interprète ce profil biométrique pour une connexion : un(e) ${gender === 'male' ? 'homme' : 'femme'} d'environ ${age} ans, affichant une expression de ${expression}. Génère un court statut de connexion et un niveau d'autorisation fictif.`;
            const interpretation = await callGeminiAPIForContent(prompt);
            interpretationResultEl.innerHTML = `<p>${interpretation}</p>`;
        });

        async function loadFaceMagicModels() {
            try {
                fmStatus.textContent = "Chargement des modèles IA...";
                const MODEL_URL = 'https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights';
                await Promise.all([
                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                    faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL),
                    faceapi.nets.ageGenderNet.loadFromUri(MODEL_URL)
                ]);
                fmStatus.textContent = "Modèles IA chargés ✅";
                return true;
            } catch (e) { fmStatus.textContent = `❌ Erreur: ${e.message}`; return false; }
        }

        async function startFaceMagicCamera() {
            try {
                fmStatus.textContent = "Accès à la caméra...";
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                fmVideo.srcObject = stream;
                return new Promise(resolve => {
                    fmVideo.onloadedmetadata = () => fmVideo.play().then(() => {
                        fmStatus.textContent = "Caméra activée ✅";
                        resolve(true);
                    });
                });
            } catch (e) { fmStatus.textContent = `❌ Erreur caméra: ${e.message}`; return false; }
        }

        async function detectFaces() {
            if (!fmIsInitialized || fmVideo.paused || fmVideo.ended) {
                fmAnimationRequest = requestAnimationFrame(detectFaces);
                return;
            }
            const displaySize = { width: fmVideo.videoWidth, height: fmVideo.videoHeight };
            faceapi.matchDimensions(fmCanvas, displaySize);
            const detections = await faceapi.detectAllFaces(fmVideo, new faceapi.SsdMobilenetv1Options()).withFaceLandmarks().withFaceExpressions().withAgeAndGender();
            fmCtx.clearRect(0, 0, fmCanvas.width, fmCanvas.height);
            faceapi.draw.drawDetections(fmCanvas, detections);
            if (detections.length > 0 && biometricResultsEl) {
                const { age, gender, expressions } = detections[0];
                const sortedExpressions = Object.entries(expressions).sort((a, b) => b[1] - a[1]);
                const primaryExpression = sortedExpressions[0][0];
                
                lastBiometricData = { age: Math.round(age), gender, expression: primaryExpression };
                interpretBtn.disabled = false;

                biometricResultsEl.innerHTML = `<div class="flex justify-between"><span>Âge:</span> <span class="font-bold text-white">${lastBiometricData.age}</span></div><div class="flex justify-between"><span>Genre:</span> <span class="font-bold text-white">${gender}</span></div><div class="mt-2"><p>Expression: <span class="font-bold text-white">${primaryExpression}</span></p></div>`;
            } else if (biometricResultsEl) {
                 lastBiometricData = null;
                 interpretBtn.disabled = true;
                 biometricResultsEl.innerHTML = `<p class="text-gray-400">Aucun visage détecté.</p>`;
                 interpretationResultEl.innerHTML = '';
            }
            fmAnimationRequest = requestAnimationFrame(detectFaces);
        }
        
        async function initFaceMagic() {
            if (fmIsInitialized) return;
            fmIsInitialized = true;
            if (await loadFaceMagicModels() && await startFaceMagicCamera()) {
                fmStatus.textContent = "Analyse active...";
                detectFaces();
            }
        }
        
        function stopFaceMagic() {
            if (!fmIsInitialized) return;
            fmVideo.srcObject?.getTracks().forEach(track => track.stop());
            fmVideo.srcObject = null;
            if (fmAnimationRequest) cancelAnimationFrame(fmAnimationRequest);
            fmIsInitialized = false;
        }
        
        // --- Task Planner Logic ---
        const generatePlanBtn = document.getElementById('generatePlanBtn');
        const projectInput = document.getElementById('projectInput');
        const missionPlanContainer = document.getElementById('missionPlanContainer');
        const missionBriefingContainer = document.getElementById('missionBriefingContainer');

        generatePlanBtn.addEventListener('click', async () => {
            const projectDescription = projectInput.value.trim();
            if (!projectDescription) {
                missionPlanContainer.innerHTML = `<p class="text-red-400 text-center">Veuillez décrire un projet.</p>`;
                return;
            }
            missionPlanContainer.innerHTML = `<p class="text-center animate-pulse">Génération du plan de mission par l'IGO...</p>`;
            missionBriefingContainer.innerHTML = '';
            
            const prompt = `Agis comme un chef de projet expert pour une initiative spatiale. Décompose l'objectif suivant en une liste de 5 à 7 tâches concrètes : "${projectDescription}".`;
            
            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "tasks": {
                                    "type": "ARRAY",
                                    "items": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "tache": { "type": "STRING" },
                                            "responsable": { "type": "STRING" },
                                            "echeance": { "type": "STRING" }
                                        },
                                        required: ["tache", "responsable", "echeance"]
                                    }
                                }
                            }
                        }
                    }
                };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                
                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text || '{"tasks": []}';
                const plan = JSON.parse(jsonText);

                if (plan.tasks && plan.tasks.length > 0) {
                    missionPlanContainer.innerHTML = `
                        <h3 class="text-2xl font-bold text-yellow-400 mb-4">Plan de Mission: ${projectDescription}</h3>
                        <ul class="space-y-3">
                            ${plan.tasks.map(task => `
                                <li class="bg-black/20 p-4 rounded-lg border border-white/10 flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold text-white">${task.tache}</p>
                                        <p class="text-sm text-gray-400">Responsable: ${task.responsable} | Échéance: ${task.echeance}</p>
                                    </div>
                                    <input type="checkbox" class="form-checkbox h-5 w-5 bg-transparent border-cyan-400 text-cyan-500 rounded focus:ring-0">
                                </li>
                            `).join('')}
                        </ul>
                        <button id="generateBriefingBtn" class="mt-6 w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg">✨ Générer un Briefing de Mission</button>
                    `;
                    document.getElementById('generateBriefingBtn').addEventListener('click', async () => {
                        missionBriefingContainer.innerHTML = '<p class="animate-pulse">Génération du briefing...</p>';
                        const tasksString = plan.tasks.map(t => `- ${t.tache}`).join('\n');
                        const briefingPrompt = `En tant que N-X-U, rédige un briefing de mission officiel et inspirant pour l'objectif suivant : "${projectDescription}". Le plan d'action est le suivant :\n${tasksString}\nAdopte un ton formel et grandiose, digne des Titans.`;
                        const briefing = await callGeminiAPIForContent(briefingPrompt);
                        missionBriefingContainer.innerHTML = `<h4 class="text-xl font-bold text-cyan-400 mb-2">Briefing de Mission</h4><p class="text-gray-300 whitespace-pre-wrap">${briefing}</p>`;
                    });
                } else {
                    missionPlanContainer.innerHTML = `<p class="text-center text-gray-400">Impossible de générer un plan pour ce projet.</p>`;
                }

            } catch (error) {
                console.error("Error generating mission plan:", error);
                missionPlanContainer.innerHTML = `<p class="text-red-400 text-center">Erreur lors de la génération du plan. Veuillez réessayer.</p>`;
            }
        });


        // --- Initial Load ---
        window.addEventListener('DOMContentLoaded', () => {
            const googleContainer = document.getElementById('googleAppsContainer');
            googleApps.forEach(app => googleContainer.appendChild(createAppCard(app)));
            const openaiContainer = document.getElementById('openaiAppsContainer');
            openaiApps.forEach(app => openaiContainer.appendChild(createAppCard(app)));
            
            showSection('heroSection');
        });
    </script>
</body>
</html>

