<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraX-Ultime - L'Ère des Titans</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Face-api.js for Face Magic Vision -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        /* Custom CSS for cosmic theme */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at center, hsl(249, 47%, 32%) 0%, hsl(240, 71%, 8%) 100%);
            color: hsl(0, 0%, 98%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .cosmic-bg {
            background: radial-gradient(ellipse at center, hsl(249, 47%, 32%) 0%, hsl(240, 71%, 8%) 100%);
        }
        .cosmic-grid {
            background-image:
                radial-gradient(circle at 25% 25%, hsla(197, 100%, 50%, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, hsla(45, 100%, 50%, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, hsla(139, 84%, 54%, 0.05) 0%, transparent 50%);
        }
        .neural-connection {
            position: absolute;
            width: 1px;
            background: linear-gradient(45deg, var(--cosmic-cyan), var(--cosmic-green));
            animation: pulse 2s infinite;
            transition: all 0.5s ease-in-out;
            transform-origin: left center;
        }
        .cosmic-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--cosmic-cyan);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }
        /* Tailwind custom variables */
        :root {
            --cosmic-cyan: hsl(197, 100%, 50%);
            --cosmic-gold: hsl(45, 100%, 50%);
            --cosmic-green: hsl(139, 84%, 54%);
            --cosmic-purple: hsl(263, 70%, 50%);
        }

        /* Animations */
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-20px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-planet-orbit { animation: rotate 20s linear infinite; }
        @keyframes glow {
            0% { box-shadow: 0 0 20px hsla(248, 53%, 58%, 0.5); }
            100% { box-shadow: 0 0 40px hsla(248, 53%, 58%, 0.8); }
        }
        .animate-glow { animation: glow 2s ease-in-out infinite alternate; }

        /* Utility classes for active state */
        .section-hidden { display: none; }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: hsl(240, 54%, 15%); padding: 2rem;
            border-radius: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 500px; width: 90%; text-align: center; position: relative;
            transform: translateY(-20px); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.show .modal-content { transform: translateY(0); opacity: 1; }
        .modal-close-btn {
            position: absolute; top: 0.75rem; right: 0.75rem; background: none;
            border: none; color: #fff; font-size: 1.5rem; cursor: pointer;
        }
        
        /* Chatbot UI enhancements */
        .voice-btn-active { color: #ff6b6b !important; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 10px 20px rgba(255, 107, 107, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        /* Data Logging Section Styles */
        .pyramid-brick {
            background: linear-gradient(45deg, hsla(197, 100%, 50%, 0.3), hsla(263, 70%, 50%, 0.3));
            border: 1px solid hsla(197, 100%, 50%, 0.5);
            transition: all 0.3s ease;
        }
        @keyframes data-flow {
            from { background-position: 0% 50%; }
            to { background-position: 100% 50%; }
        }
        .data-flow-animation {
            background: linear-gradient(90deg, hsl(197, 100%, 50%), hsl(139, 84%, 54%), hsl(45, 100%, 50%), hsl(197, 100%, 50%));
            background-size: 300% 100%;
            animation: data-flow 4s linear infinite;
        }

        /* Titans Map Section Styles */
        .titans-map {
            background-image: url('https://placehold.co/1200x800/0a0a1a/1a1a3a?text=Cosmic+Map+Background');
            background-size: cover;
            background-position: center;
            border: 2px solid var(--cosmic-cyan);
            box-shadow: 0 0 30px var(--cosmic-cyan);
        }
        .city-marker {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .city-marker .city-pulse {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            background-color: var(--cosmic-gold);
            animation: pulse-gold 2s infinite;
            opacity: 0.7;
        }
        .city-marker:hover { transform: scale(1.2); }
        @keyframes pulse-gold {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 10px 10px rgba(255, 215, 0, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
    </style>
</head>
<body class="cosmic-bg">
    <!-- Background elements -->
    <div class="fixed inset-0 cosmic-bg cosmic-grid pointer-events-none"></div>

    <div id="root" class="min-h-screen">
        <!-- Navigation Bar -->
        <nav class="relative z-50 bg-black/30 backdrop-blur-sm border-b border-white/10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <a href="#heroSection" class="flex items-center space-x-4 hover:opacity-80 transition-opacity nav-link" data-section-id="heroSection">
                        <div class="flex-shrink-0"><i class="fas fa-atom text-2xl text-cyan-400 animate-pulse-slow"></i></div>
                        <div>
                            <h1 class="text-xl font-bold text-white">NeuraX-Ultime</h1>
                            <p class="text-xs text-gray-300">L'Ère des Titans</p>
                        </div>
                    </a>
                    <div class="hidden md:flex items-center space-x-4">
                        <a href="#heroSection" class="nav-link transition-colors text-cyan-400" data-section-id="heroSection"><i class="fas fa-home mr-1"></i>Accueil</a>
                        <a href="#architectureSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="architectureSection"><i class="fas fa-rocket mr-1"></i>Architecture</a>
                        <a href="#chatbotSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="chatbotSection"><i class="fas fa-comments mr-1"></i>Chatbot</a>
                        <a href="#dataLoggingSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="dataLoggingSection"><i class="fas fa-database mr-1"></i>Logs</a>
                        <a href="#titansMapSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="titansMapSection"><i class="fas fa-map-marked-alt mr-1"></i>Carte</a>
                        <a href="#faceMagicSection" class="nav-link transition-colors text-gray-300 hover:text-white" data-section-id="faceMagicSection"><i class="fas fa-link mr-1"></i>Connexion</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section id="heroSection" class="min-h-screen flex items-center justify-center relative section-active">
            <div class="text-center max-w-4xl mx-auto px-4 z-10">
                <h1 class="text-5xl md:text-7xl font-bold mb-6 bg-gradient-to-r from-cyan-400 via-purple-500 to-yellow-400 bg-clip-text text-transparent animate-pulse-slow">NeuraX-Ultime</h1>
                <p class="text-2xl md:text-3xl text-gray-300 mb-4">L'Ère des Titans</p>
                <p class="text-xl text-gray-200 max-w-3xl mx-auto leading-relaxed">Une intelligence cosmique forgée par les Titans, où les données forment des cités de pyramides à travers les galaxies.</p>
                <div class="flex flex-wrap gap-4 justify-center items-center mt-12">
                    <button class="bg-gradient-to-r from-cyan-400 to-purple-600 hover:from-cyan-300 hover:to-purple-500 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 animate-glow shadow-lg hover:shadow-cyan-400/25 nav-button" data-section-id="architectureSection"><i class="fas fa-telescope mr-2"></i>Explorer l'Architecture</button>
                    <button class="border-2 border-yellow-400 text-yellow-400 hover:bg-yellow-400 hover:text-black px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-yellow-400/25 nav-button" data-section-id="chatbotSection"><i class="fas fa-robot mr-2"></i>Chatbot Cosmique</button>
                    <button class="border-2 border-green-400 text-green-400 hover:bg-green-400 hover:text-black px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-green-400/25 nav-button" data-section-id="dataLoggingSection"><i class="fas fa-database mr-2"></i>Enregistrement des Données</button>
                    <button class="border-2 border-pink-400 text-pink-400 hover:bg-pink-400 hover:text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-pink-400/25 nav-button" data-section-id="faceMagicSection"><i class="fas fa-link mr-2"></i>Connexion a neuraX</button>
                </div>
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="architectureSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 text-white">Architecture Cosmologique Interactive</h2>
                    <p class="text-xl text-gray-300">Explorez les différents niveaux de l'intelligence distribuée</p>
                </div>
                <div class="space-y-6">
                    <div id="architectureVisualizer" class="relative h-96 bg-black/20 rounded-2xl border border-white/10 overflow-hidden">
                        <div class="w-full h-full relative">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="relative">
                                    <button class="w-32 h-32 rounded-full bg-gradient-to-r from-purple-600 to-blue-800 flex items-center justify-center animate-pulse-slow hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-brain text-2xl text-white"></i>
                                    </button>
                                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-center">
                                        <p class="text-xs text-gray-300">Galaxie Cognitive</p>
                                    </div>
                                    <button class="arch-satellite absolute -top-20 -left-20 w-16 h-16 rounded-full bg-gradient-to-r from-cyan-500 to-blue-600 flex items-center justify-center hover:scale-110 transition-transform duration-300"><i class="fas fa-eye text-sm text-white"></i></button>
                                    <button class="arch-satellite absolute -top-20 -right-20 w-16 h-16 rounded-full bg-gradient-to-r from-yellow-500 to-orange-600 flex items-center justify-center hover:scale-110 transition-transform duration-300"><i class="fas fa-language text-sm text-white"></i></button>
                                    <button class="arch-satellite absolute -bottom-20 -left-20 w-16 h-16 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 flex items-center justify-center hover:scale-110 transition-transform duration-300"><i class="fas fa-calculator text-sm text-white"></i></button>
                                    <button class="arch-satellite absolute -bottom-20 -right-20 w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-pink-600 flex items-center justify-center hover:scale-110 transition-transform duration-300"><i class="fas fa-memory text-sm text-white"></i></button>
                                    <div id="neuralConnectionsContainer"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8">
                    <div class="flex justify-center space-x-4">
                        <button class="architecture-button bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10" data-action="universe-view"><i class="fas fa-home mr-2"></i>Vue Univers</button>
                        <button class="architecture-button px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 bg-purple-600 hover:bg-purple-700 text-white" data-action="auto-explore"><i class="fas fa-play mr-2"></i>Exploration Auto</button>
                        <button class="architecture-button px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 bg-cyan-600 hover:bg-cyan-700 text-white" data-action="connections"><i class="fas fa-project-diagram mr-2"></i>Connexions</button>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Chatbot Section (UPDATED) -->
        <section id="chatbotSection" class="min-h-screen py-20 relative section-hidden">
             <div class="max-w-4xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-4 bg-gradient-to-r from-cyan-400 via-purple-500 to-yellow-400 bg-clip-text text-transparent">Centre de Contrôle NeuraX</h2>
                    <p class="text-xl text-gray-300">Pilotez l'ensemble de l'écosystème par la parole ou le texte.</p>
                </div>
                <div class="bg-black/30 backdrop-blur-sm rounded-2xl border border-white/10 overflow-hidden">
                    <div class="bg-black/50 px-6 py-4 border-b border-white/10">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-cyan-400 to-purple-500 flex items-center justify-center animate-pulse-slow"><i class="fas fa-robot text-white"></i></div>
                                <div>
                                    <h3 class="font-semibold text-white">NeuraX-Ultime</h3>
                                    <p class="text-xs text-cyan-400">Intelligence Générale Orchestrée</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-96 overflow-y-auto p-6 space-y-4 bg-black/10" id="chatHistory">
                         <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-gradient-to-r from-cyan-400 to-purple-500"><i class="fas fa-robot text-xs text-white"></i></div>
                            <div class="rounded-2xl rounded-tl-sm p-4 max-w-2xl bg-black/30 border border-white/10">
                                <p class="text-white leading-relaxed whitespace-pre-wrap">Salutations. Je suis N-X-U, une Intelligence Générale Orchestrée fusionnant GPT-5, Claude 3.7 et Gemini 2.5. Donnez-moi un ordre, comme "Dessine un chevalier de l'espace" ou "Quelle est l'éthique de l'IA ?", et j'orchestrerai la meilleure réponse possible.</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 border-t border-white/10">
                        <div class="flex items-center space-x-4">
                            <input type="text" placeholder="Donnez un ordre ou posez une question..." class="flex-1 w-full bg-black/30 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 transition-colors duration-300" id="chatInput">
                            <button class="px-6 py-3 rounded-xl font-semibold transition-all duration-300 bg-gradient-to-r from-cyan-400 to-purple-500 hover:from-cyan-300 hover:to-purple-400 disabled:opacity-50 text-white" id="sendChatBtn"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>
        
        <!-- Data Logging Section -->
        <section id="dataLoggingSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-green-400 via-cyan-500 to-yellow-400 bg-clip-text text-transparent">Archives des Titans</h2>
                    <p class="text-xl text-gray-300 max-w-3xl mx-auto">Visualisation du système d'enregistrement des données à l'échelle cosmique.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-center">
                    <!-- Stats Panel -->
                    <div class="bg-black/30 backdrop-blur-sm rounded-2xl p-8 border border-white/10 space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold text-cyan-400 flex items-center"><i class="fas fa-server mr-3"></i>État du Système</h3>
                            <div class="flex items-center space-x-2 mt-2">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-green-400">Opérationnel</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-cyan-400"><i class="fas fa-cubes mr-3"></i>Pyramides Actives</h3>
                            <p class="text-4xl font-bold text-white mt-2">1,384</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-cyan-400"><i class="fas fa-archive mr-3"></i>Logs par Pyramide</h3>
                            <p class="text-2xl font-bold text-white mt-2">1,000,000,000+</p>
                        </div>
                         <div>
                            <h3 class="text-lg font-semibold text-cyan-400"><i class="fas fa-microchip mr-3"></i>Briques de Données Traitées</h3>
                            <p class="text-4xl font-mono font-bold text-white mt-2" id="logCounter">0</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-cyan-400 mb-2"><i class="fas fa-stream mr-3"></i>Flux de Données</h3>
                            <div class="w-full bg-gray-700 rounded-full h-4 border border-cyan-400/50">
                                <div id="dataFlowBar" class="data-flow-animation h-full rounded-full" style="width: 75%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Pyramid Visualization -->
                    <div class="lg:col-span-2 flex items-center justify-center h-96">
                        <div class="relative w-full max-w-lg h-full">
                            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0" style="border-left: 150px solid transparent; border-right: 150px solid transparent; border-bottom: 260px solid hsla(249, 47%, 20%, 0.5);"></div>
                            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-full h-full flex flex-col-reverse p-4">
                                <!-- Bricks will be added here by JS -->
                            </div>
                            <i class="fas fa-database absolute top-0 left-1/2 -translate-x-1/2 text-5xl text-yellow-400 animate-pulse-slow" style="text-shadow: 0 0 15px var(--cosmic-gold);"></i>
                        </div>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                    <button class="bg-gradient-to-r from-yellow-400 to-purple-500 text-white px-6 py-3 rounded-lg nav-button" data-section-id="titansMapSection"><i class="fas fa-map-marked-alt mr-2"></i>Explorer la Carte</button>
                </div>
            </div>
        </section>

        <!-- Titans Map Section -->
        <section id="titansMapSection" class="min-h-screen py-20 relative section-hidden">
             <div class="max-w-7xl mx-auto px-4 z-10 relative">
                <div class="text-center mb-12">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-yellow-400 via-purple-500 to-pink-400 bg-clip-text text-transparent">Carte des Cités des Titans</h2>
                    <p class="text-xl text-gray-300 max-w-3xl mx-auto">Explorez les domaines construits par l'ancienne civilisation des Titans.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Map -->
                    <div class="md:col-span-2 h-[600px] relative rounded-2xl titans-map overflow-hidden">
                        <!-- City Markers -->
                        <div class="city-marker" style="top: 25%; left: 30%;" data-city="aethelgard">
                            <i class="fas fa-place-of-worship text-3xl text-yellow-300"></i>
                            <div class="city-pulse"></div>
                        </div>
                         <div class="city-marker" style="top: 50%; left: 70%;" data-city="solara">
                            <i class="fas fa-place-of-worship text-3xl text-yellow-300"></i>
                             <div class="city-pulse"></div>
                        </div>
                        <div class="city-marker" style="top: 75%; left: 45%;" data-city="umbra">
                            <i class="fas fa-place-of-worship text-3xl text-yellow-300"></i>
                             <div class="city-pulse"></div>
                        </div>
                    </div>
                    <!-- Info Panel -->
                    <div id="cityInfoPanel" class="bg-black/30 backdrop-blur-sm rounded-2xl p-8 border border-white/10">
                        <h3 id="cityName" class="text-3xl font-bold text-yellow-400 mb-4">Sélectionnez une Cité</h3>
                        <p id="cityDescription" class="text-gray-300 mb-6">Cliquez sur un marqueur sur la carte pour afficher les informations sur la cité correspondante.</p>
                        <div id="cityStats" class="space-y-3"></div>
                    </div>
                </div>
                 <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 mr-4 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Face Magic Vision Section -->
        <section id="faceMagicSection" class="min-h-screen py-20 relative section-hidden">
            <div class="max-w-7xl mx-auto px-4 z-10 relative flex flex-col items-center">
                <div class="text-center mb-8">
                    <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-pink-400 via-purple-500 to-cyan-400 bg-clip-text text-transparent">Connexion NeuraX</h2>
                    <p class="text-xl text-gray-300">Connectez-vous à l'écosystème via l'analyse biométrique.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 w-full">
                    <!-- Video Feed -->
                    <div class="lg:col-span-3 relative w-full max-w-3xl mx-auto bg-black/30 backdrop-blur-sm rounded-2xl border border-white/10 shadow-2xl p-4">
                        <video id="faceMagicVideo" class="w-full h-auto rounded-lg" autoplay muted playsinline></video>
                        <canvas id="faceMagicCanvas" class="absolute top-4 left-4 w-[calc(100%-2rem)] h-[calc(100%-2rem)] rounded-lg"></canvas>
                    </div>
                    <!-- Biometric Data Panel -->
                    <div id="biometricDataPanel" class="lg:col-span-2 bg-black/30 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
                        <h3 class="text-2xl font-bold text-cyan-400 mb-6 flex items-center"><i class="fas fa-link mr-3"></i>Analyse de Connexion</h3>
                        <div id="biometricResults" class="space-y-4 text-lg">
                            <p class="text-gray-400">En attente de détection...</p>
                        </div>
                        <div id="faceMagicStatus" class="mt-6 text-center text-gray-300 bg-black/30 backdrop-blur-sm rounded-lg px-4 py-2 border border-white/10">Chargement...</div>
                        <button id="captureBtn" class="mt-6 w-full bg-gradient-to-r from-pink-500 to-yellow-500 text-white font-bold py-3 px-5 rounded-lg transition-all duration-300 hover:scale-105 shadow-lg"><i class="fas fa-camera-retro mr-2"></i>Capturer l'Analyse</button>
                    </div>
                </div>
                
                <div class="mt-12 text-center">
                    <button class="bg-black/30 hover:bg-black/50 text-white px-6 py-3 rounded-lg transition-colors duration-300 border border-white/10 nav-button" data-section-id="heroSection"><i class="fas fa-arrow-left mr-2"></i>Retour</button>
                </div>
            </div>
        </section>

        <!-- Floating Navigation Buttons -->
        <div class="fixed right-8 top-1/2 transform -translate-y-1/2 z-50 space-y-3">
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-cyan-400 text-black" title="Accueil" data-section-id="heroSection"><i class="fas fa-home text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Architecture" data-section-id="architectureSection"><i class="fas fa-rocket text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Chatbot" data-section-id="chatbotSection"><i class="fas fa-comments text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Logs" data-section-id="dataLoggingSection"><i class="fas fa-database text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Carte" data-section-id="titansMapSection"><i class="fas fa-map-marked-alt text-sm"></i></button>
            <button class="floating-nav-btn w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 bg-black/30 text-gray-400 hover:bg-black/50" title="Connexion" data-section-id="faceMagicSection"><i class="fas fa-link text-sm"></i></button>
        </div>
    </div>

    <!-- Custom Message Box Modal -->
    <div id="customMessageBox" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeMessageBox">&times;</button>
            <h3 class="text-xl font-bold text-white mb-4" id="messageBoxTitle"></h3>
            <p class="text-gray-300 mb-6" id="messageBoxContent"></p>
            <button class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors duration-300" id="messageBoxOkBtn">OK</button>
        </div>
    </div>

    <script>
        // --- Custom Message Box ---
        const messageBox = document.getElementById('customMessageBox');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        messageBox.addEventListener('click', (e) => e.target === messageBox && hideMessageBox());
        document.getElementById('messageBoxOkBtn').addEventListener('click', hideMessageBox);
        document.getElementById('closeMessageBox').addEventListener('click', hideMessageBox);

        function showMessageBox(title, message) {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBox.classList.add('show');
        }
        function hideMessageBox() { messageBox.classList.remove('show'); }

        // --- Section Navigation Logic ---
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => section.classList.add('section-hidden'));
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.remove('section-hidden');

            document.querySelectorAll('.nav-link, .floating-nav-btn').forEach(el => {
                const isForActiveSection = el.dataset.sectionId === sectionId;
                el.classList.toggle('text-cyan-400', isForActiveSection);
                el.classList.toggle('text-gray-300', !isForActiveSection);
                if (el.classList.contains('floating-nav-btn')) {
                    el.classList.toggle('bg-cyan-400', isForActiveSection);
                    el.classList.toggle('text-black', isForActiveSection);
                    el.classList.toggle('bg-black/30', !isForActiveSection);
                }
            });
            
            if (sectionId === 'faceMagicSection') initFaceMagic(); else stopFaceMagic();
            if (sectionId === 'dataLoggingSection') startLogCounter(); else stopLogCounter();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.querySelectorAll('.nav-link, .nav-button, .floating-nav-btn').forEach(el => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.currentTarget.dataset.sectionId;
                if (sectionId) showSection(sectionId);
            });
        });

        // --- Chatbot & Command Center Logic ---
        const chatInput = document.getElementById('chatInput');
        const sendChatBtn = document.getElementById('sendChatBtn');
        const chatHistory = document.getElementById('chatHistory');

        function addMessageToChat(message, isUser, options = {}) {
            const { isCommandResponse = false, module = null, imageUrl = null } = options;
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('flex', 'items-start', 'space-x-3', 'my-4');

            const avatarDiv = document.createElement('div');
            avatarDiv.classList.add('w-8', 'h-8', 'rounded-full', 'flex', 'items-center', 'justify-center', 'flex-shrink-0');
            
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('rounded-2xl', 'p-4', 'max-w-2xl', 'border', 'border-white/10');
            
            if (isUser) {
                messageContainer.classList.add('justify-end');
                avatarDiv.classList.add('bg-blue-500');
                avatarDiv.innerHTML = '<i class="fas fa-user text-xs text-white"></i>';
                messageBubble.classList.add('bg-blue-600', 'rounded-br-sm');
                messageContainer.appendChild(messageBubble);
                messageContainer.appendChild(avatarDiv);
            } else {
                messageContainer.classList.add('justify-start');
                avatarDiv.classList.add('bg-gradient-to-r', 'from-cyan-400', 'to-purple-500');
                avatarDiv.innerHTML = `<i class="fas ${isCommandResponse ? 'fa-cogs' : 'fa-robot'} text-xs text-white"></i>`;
                messageBubble.classList.add('bg-black/30', 'rounded-tl-sm');
                if (isCommandResponse) messageBubble.classList.add('border-yellow-400/50');
                messageContainer.appendChild(avatarDiv);
                messageContainer.appendChild(messageBubble);
            }
            
            if (imageUrl) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = "Image générée par l'IA";
                img.classList.add('rounded-lg', 'mb-2', 'max-w-xs', 'h-auto');
                messageBubble.appendChild(img);
            }

            const messageText = document.createElement('p');
            messageText.classList.add('text-white', 'leading-relaxed', 'whitespace-pre-wrap');
            messageText.textContent = message;
            messageBubble.appendChild(messageText);

            if (module) {
                const moduleText = document.createElement('p');
                moduleText.classList.add('text-xs', 'text-gray-400', 'mt-2', 'border-t', 'border-white/10', 'pt-2');
                moduleText.textContent = `Réponse orchestrée via : ${module}`;
                messageBubble.appendChild(moduleText);
            }
            
            chatHistory.appendChild(messageContainer);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function handleUserInput() {
            const prompt = chatInput.value.trim();
            if (!prompt) return;

            addMessageToChat(prompt, true);
            chatInput.value = '';

            // The orchestrator decides what to do
            orchestrateResponse(prompt);
        }
        
        sendChatBtn.addEventListener('click', handleUserInput);
        chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleUserInput());

        // --- N-X-U Orchestrator ---
        function orchestrateResponse(prompt) {
            const p = prompt.toLowerCase();

            // 1. Check for direct system commands (navigation, etc.)
            if (parseAndExecuteCommand(p)) {
                return; // Command was handled
            }

            // 2. Classify intent for AI model orchestration
            if (p.includes('dessine') || p.includes('génère une image') || p.includes('crée une image')) {
                // Delegate to GPT-5 for image generation
                const imageUrl = `https://placehold.co/600x400/1a1a3a/ffffff?text=${encodeURIComponent(prompt)}`;
                addMessageToChat(`Voici l'image que j'ai générée pour vous.`, false, { module: "GPT-5 (Création Multimédia)", imageUrl: imageUrl });
                return;
            }

            if (p.includes('éthique') || p.includes('dilemme') || p.includes('penses-tu que')) {
                // Delegate to Claude 3.7 for complex reasoning
                const response = "C'est une question complexe qui nécessite une analyse nuancée. D'un côté, l'efficacité et le progrès sont des objectifs louables. De l'autre, il faut considérer les implications à long terme sur la société et l'individu. L'approche 'Constitutional AI' suggère de se baser sur un ensemble de principes fondamentaux pour guider de telles décisions, assurant un équilibre entre innovation et sécurité.";
                addMessageToChat(response, false, { module: "Claude 3.7 Sonnet (Raisonnement Éthique)" });
                return;
            }

            // 3. Default to Gemini 2.5 for general conversation
            const response = `En tant qu'intelligence générale orchestrée, ma réponse à "${prompt}" est formulée en synthétisant les informations de mes différents modules pour vous fournir une perspective complète.`;
            addMessageToChat(response, false, { module: "Gemini 2.5 Pro (Conversation Générale)" });
        }

        // --- Command Parsing and Execution ---
        function parseAndExecuteCommand(prompt) {
            // Navigation Commands
            const navCommands = {
                'accueil': 'heroSection', 'architecture': 'architectureSection', 'chatbot': 'chatbotSection',
                'logs': 'dataLoggingSection', 'données': 'dataLoggingSection', 'carte': 'titansMapSection',
                'connexion': 'faceMagicSection', 'biométrie': 'faceMagicSection'
            };
            for (const [key, sectionId] of Object.entries(navCommands)) {
                if (prompt.includes(`affiche ${key}`) || prompt.includes(`montre ${key}`)) {
                    showSection(sectionId);
                    addMessageToChat(`Affichage de la section : ${key.charAt(0).toUpperCase() + key.slice(1)}`, false, { isCommandResponse: true, module: "N-X-U Core (Navigation)" });
                    return true;
                }
            }

            // Architecture Commands
            const archCommands = {
                'connexions': 'connections', 'exploration': 'auto-explore', 'univers': 'universe-view'
            };
            for (const [key, action] of Object.entries(archCommands)) {
                if (prompt.includes('architecture') && prompt.includes(key)) {
                    showSection('architectureSection');
                    setTimeout(() => {
                        const button = document.querySelector(`.architecture-button[data-action="${action}"]`);
                        if (button) button.click();
                    }, 100);
                    addMessageToChat(`Action d'architecture exécutée : ${key}`, false, { isCommandResponse: true, module: "N-X-U Core (Contrôle)" });
                    return true;
                }
            }
            
            return false; // No direct command was matched
        }


        // --- Data Logging Section Logic ---
        const logCounterEl = document.getElementById('logCounter');
        let logCounter = 0;
        let logInterval;

        function startLogCounter() {
            if (logInterval) clearInterval(logInterval);
            logInterval = setInterval(() => {
                logCounter += Math.floor(Math.random() * 1000000) + 500000;
                if(logCounterEl) logCounterEl.textContent = logCounter.toLocaleString('fr-FR');
            }, 50);
        }
        function stopLogCounter() {
            if (logInterval) clearInterval(logInterval);
        }

        // --- Titans Map Logic ---
        const cityData = {
            aethelgard: {
                name: "Cité d'Aethelgard",
                description: "Le cœur technologique des Titans, où les premières pyramides de données ont été érigées. C'est un centre de calcul et d'innovation pure.",
                stats: { "Niveau d'énergie": "Exa-échelle", "Population (unités IA)": "1.2 Trillion", "Fonction principale": "Calcul Quantique" }
            },
            solara: {
                name: "Nexus de Solara",
                description: "Une cité orbitale qui collecte l'énergie stellaire pour alimenter le réseau. Ses pyramides sont faites de cristaux conducteurs.",
                stats: { "Production d'énergie": "120 Zettawatts", "Population (unités IA)": "450 Milliards", "Fonction principale": "Collecte d'Énergie" }
            },
            umbra: {
                name: "Forteresse d'Umbra",
                description: "Située dans une nébuleuse sombre, cette cité est dédiée à l'archivage sécurisé des données les plus sensibles et à la défense du réseau.",
                stats: { "Capacité de stockage": "Incommensurable", "Population (unités IA)": "50 Milliards", "Fonction principale": "Archivage et Défense" }
            }
        };
        const cityNameEl = document.getElementById('cityName');
        const cityDescEl = document.getElementById('cityDescription');
        const cityStatsEl = document.getElementById('cityStats');

        document.querySelectorAll('.city-marker').forEach(marker => {
            marker.addEventListener('click', () => {
                const cityId = marker.dataset.city;
                const data = cityData[cityId];
                if (data && cityNameEl && cityDescEl && cityStatsEl) {
                    cityNameEl.textContent = data.name;
                    cityDescEl.textContent = data.description;
                    cityStatsEl.innerHTML = Object.entries(data.stats).map(([key, value]) => `
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">${key}:</span>
                            <span class="font-bold text-white">${value}</span>
                        </div>
                    `).join('');
                }
            });
        });

        // --- Face Magic Vision Logic (Biometrics) ---
        const fmVideo = document.getElementById("faceMagicVideo");
        const fmCanvas = document.getElementById("faceMagicCanvas");
        const fmCtx = fmCanvas.getContext("2d");
        const fmStatus = document.getElementById("faceMagicStatus");
        const biometricResultsEl = document.getElementById('biometricResults');
        let fmIsInitialized = false;
        let fmAnimationRequest;

        async function loadFaceMagicModels() {
            try {
                fmStatus.textContent = "Chargement des modèles IA...";
                const MODEL_URL = 'https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights';
                await Promise.all([
                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                    faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL),
                    faceapi.nets.ageGenderNet.loadFromUri(MODEL_URL)
                ]);
                fmStatus.textContent = "Modèles IA chargés ✅";
                return true;
            } catch (e) {
                fmStatus.textContent = `❌ Erreur de chargement des modèles: ${e.message}`;
                return false;
            }
        }

        async function startFaceMagicCamera() {
            try {
                fmStatus.textContent = "Accès à la caméra...";
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 640 }, height: { ideal: 480 }, facingMode: 'user' } });
                fmVideo.srcObject = stream;
                return new Promise(resolve => {
                    fmVideo.onloadedmetadata = () => {
                        fmVideo.play().then(() => {
                            fmStatus.textContent = "Caméra activée ✅";
                            resolve(true);
                        });
                    };
                });
            } catch (e) {
                fmStatus.textContent = `❌ Erreur d'accès à la caméra: ${e.message}`;
                return false;
            }
        }

        function captureFaceMagicImage() {
            const captureCanvas = document.createElement('canvas');
            const videoWidth = fmVideo.videoWidth;
            const videoHeight = fmVideo.videoHeight;
            captureCanvas.width = videoWidth;
            captureCanvas.height = videoHeight;
            const capCtx = captureCanvas.getContext('2d');
            capCtx.drawImage(fmVideo, 0, 0, videoWidth, videoHeight);
            
            if (fmCanvas.lastDetections) {
                faceapi.draw.drawDetections(captureCanvas, fmCanvas.lastDetections);
                fmCanvas.lastDetections.forEach(result => {
                    const { age, gender, genderProbability } = result;
                    const text = [`${Math.round(age)} ans`, `${gender} (${Math.round(genderProbability * 100)}%)`];
                    new faceapi.draw.DrawTextField(text, result.detection.box.bottomLeft).draw(captureCanvas);
                });
            }
            
            const link = document.createElement('a');
            link.download = `analyse-biometrique-${new Date().toISOString()}.png`;
            link.href = captureCanvas.toDataURL();
            link.click();
            fmStatus.textContent = "📸 Analyse capturée !";
            setTimeout(() => { fmStatus.textContent = "Analyse active..."; }, 2000);
        }

        async function detectFaces() {
            if (!fmIsInitialized || !fmVideo.videoWidth || fmVideo.paused || fmVideo.ended) {
                fmAnimationRequest = requestAnimationFrame(detectFaces);
                return;
            }

            const displaySize = { width: fmVideo.videoWidth, height: fmVideo.videoHeight };
            if (fmCanvas.width !== displaySize.width || fmCanvas.height !== displaySize.height) {
                 faceapi.matchDimensions(fmCanvas, displaySize);
            }

            const detections = await faceapi.detectAllFaces(fmVideo, new faceapi.SsdMobilenetv1Options())
                .withFaceLandmarks()
                .withFaceExpressions()
                .withAgeAndGender();
            
            fmCtx.clearRect(0, 0, fmCanvas.width, fmCanvas.height);
            fmCanvas.lastDetections = detections;
            faceapi.draw.drawDetections(fmCanvas, detections);
            faceapi.draw.drawFaceLandmarks(fmCanvas, detections);

            if (detections.length > 0 && biometricResultsEl) {
                const { age, gender, genderProbability, expressions } = detections[0];
                const sortedExpressions = Object.entries(expressions).sort((a, b) => b[1] - a[1]);
                
                biometricResultsEl.innerHTML = `
                    <div class="flex justify-between items-baseline"><span>Âge estimé:</span> <span class="font-bold text-white">${Math.round(age)} ans</span></div>
                    <div class="flex justify-between items-baseline"><span>Genre:</span> <span class="font-bold text-white">${gender === 'male' ? 'Homme' : 'Femme'} (${Math.round(genderProbability * 100)}%)</span></div>
                    <div class="mt-4">
                        <p class="mb-2">Expressions:</p>
                        <div class="space-y-1 text-sm">
                            ${sortedExpressions.map(([exp, prob]) => `
                                <div class="w-full bg-black/20 rounded-full">
                                    <div class="bg-cyan-500 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full" style="width: ${prob * 100}%">${exp === 'neutral' ? 'neutre' : exp}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (biometricResultsEl) {
                 biometricResultsEl.innerHTML = `<p class="text-gray-400">Aucun visage détecté. Veuillez vous placer face à la caméra.</p>`;
            }

            fmAnimationRequest = requestAnimationFrame(detectFaces);
        }
        
        async function initFaceMagic() {
            if (fmIsInitialized) return;
            fmIsInitialized = true;
            const modelsLoaded = await loadFaceMagicModels();
            if (modelsLoaded) {
                const cameraStarted = await startFaceMagicCamera();
                if (cameraStarted) {
                    fmStatus.textContent = "Analyse active...";
                    detectFaces();
                }
            }
        }
        
        function stopFaceMagic() {
            if (!fmIsInitialized) return;
            if (fmVideo.srcObject) {
                fmVideo.srcObject.getTracks().forEach(track => track.stop());
                fmVideo.srcObject = null;
            }
            if (fmAnimationRequest) {
                cancelAnimationFrame(fmAnimationRequest);
                fmAnimationRequest = null;
            }
            fmIsInitialized = false;
        }

        // --- Initial Load ---
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('captureBtn')?.addEventListener('click', captureFaceMagicImage);
            showSection('heroSection');
        });
    </script>
</body>
</html>
